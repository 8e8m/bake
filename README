--- README

Run embedded scripts.

Bootstrap with ./awake bake.l
then compile further with ./bake,

OR JUST RUN: ./install.sh (has --help)

---

bake [-chln] [-s <n>] <FILENAME> [ARGS...]; version 20250104

Bake is a simple tool meant to execute embedded shell commands within
any file. It executes with /bin/sh the command after a "@BAKE " to the
end of the line (a UNIX newline: '\n') OR to the first instance of
@STOP. All (@BAKE - @STOP) statements must precede all (@BAKE - EOL)
statements.

I cannot stress this enough: Bake executes in the directory of the
file specified.

It expands some macros,
  @FILE                 - filename
  @SHORT                - filename without suffix (abc.x.txt \-> abc.x)
  @SHORT:N              - removes N suffixes, so (a.b.c 2 -> a)
  @ARGS                 - other arguments to the program
  @ARGS:N               - Provides the Nth argument, starting from 0
  @ARGS:N+              - All arguments at and after Nth
  @RECURS               - the full path name to the executable
  @RECURS:N             - @RECURS -s N
  @LINE                 - line number at the selected @BAKE

Some additional specialized macros exist:
  @CC                  - cc @ARGS:0 -o @SHORT @FILE @ARGS:1
  @CC:/path/to/cc      - /path/to/cc @ARGS:0 -o @SHORT @FILE @ARGS:1
  @RECUR:N             - @RECURS:N -q @FILE = @RECUR:N

Old way of things that you shouldn't do unless you're me or @agvxov:
  $@ = @FILE
  $* = @SHORT
  $+ = @ARGS

All  macros  can be  exempted  by  prefixing  them with  a  backslash,
which'll be subtracted in the  expansion. Commands may be spanned over
several lines with a leading backslash.

A list of all @BAKEs in a file can be retrieved with
  bake -l file.c
To select one of these, just use
  bake -s <N>

@{filename-to-remove} will remove a specific file when
  bake -x /path/to/file.c
  -> remove at directory of /path/to the file filename-to-remove
with respect to the chosen statement.

See the manpage for more info.

-h --help       | Help message
-n --dry-run	| don't execute or remove anything
-q --quiet      | Only output subprogram output
-l --list       | lists available Bake blocks
-s --select <n>	| selects Nth Bake block
-x --expunge	| Removes the file specified in the expunge block

It roots the shell execution in the directory of the given file.

Licensed under the CC0-1.0.

---

Shake

Bake was inspired by the Bash-based Shake utility (formerly eMake,
he liked my suggestion for a name). It is included under authorization
of its creator. The original version of Shake may be found at:
<http://bis64wqhh3louusbd45iyj76kmn4rzw5ysawyan5bkxwyzihj67c5lid.onion/anon/shake>

Bake includes a modified Shake, optionally installation and as the
old bootstrapper. The modified version includes all features of Bake
with the exceptions of multi-line commands and usable expunge.

Changelog

Bake was created on 2023-09-13, and complete as of 2024-03-02.  While
it was completed in 2024-03-02 with a focus on very low, tight memory
usage this was not the final version.

On 2024-09-27, Bake was revised using Flex, which was faster. I
consider the Flex version finished as of 2025-09-11. For a fully
featured version - as in all extraneous features - use the latest
version.

--

2024-03-02

Initial relaase

2024-04-04

Expunge & color.

2024-04 - 2024-08 - 3 Tags of bump -> minor fixes and improvements

2024-09-27

Lex. As adviced by the original creator, I learned and implemented
a Bake with lex. It's fully featured, and has new stuff.

2024-10-24
- Awake

Egor (some dead guy) made an AWK implementation of Bake, it's POSIX.
It doesn't support multi-line, expunge, parses options after filename,
or changing directory to file's directory - it's compatible with Bake
otherwise. It's the new bootstrapper as AWK should be more portable
to the BSDs.

cd /dir/of/file; awake file
See --help

2025-01-04

Introducing some breaking changes.
Removed @FILENAME @NAME, and @FILE_NAME (heyo) leaving only @FILE.
Upgraded ./install.sh to have options.

s/@(FILE_?NAME|NAME)/@FILE/g

2025-09-11

-c destroyed from outerspace. -q added. all Bake specific output is
now stderr. use NO_COLOR=1 instead of -c.

2025-12-08

Fixed bug with not literally everything being stderr.  Which was -l
misalignment.

2025-12-13

Added @CC and @RECUR:N:
@CC = cc @ARGS:0 -o @SHORT @FILE @ARGS:1
@CC:/path/to/compiler = /path/to/compiler @ARGS:0 -o @SHORT @FILE @ARGS:1
@RECUR:N = @RECURS:N -q @FILE

> Why??!
@CC: I wanted something that does what I do in most usages of Bake.
@RECURS:N: This is a nice looking hack benefiting @CC's design.

--

Anonson, the original creator, made an ebuild for Gentoo:
 See <https://bis64wqhh3louusbd45iyj76kmn4rzw5ysawyan5bkxwyzihj67c5lid.onion/anon/agvxov-overlay>
 (this link is dead because Gitea died on him. If I get notice of him
  mirroring it, I'll link it here.)

 packaged under the agvxov overlay as dev-build/bake, see the README
 for including this into your installation.

debian: Provided in repo, run...
 tar cJvf bake_20251213.orig.tar.xz --exclude=debian bake-20251213/
 dpkg-buildpackage -us -uc
 dpkg -i ../bake_20251213_*.deb

Or download from the releases.

I'm finished with tool for the rest of time.
If I use it and it breaks, I'll fix it. If there's an issue:

Send mail to <mailto:emil@chud.cyou>
